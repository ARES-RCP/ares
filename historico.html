<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>HistÃ³rico do Ãšltimo Atendimento - ARES</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }
    .container {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-width: 600px;
      margin: auto;
    }
    h2 {
      text-align: center;
      color: #004aad;
    }
    .info {
      margin: 10px 0;
      padding: 10px;
      border-bottom: 1px solid #ddd;
    }
    .label {
      font-weight: bold;
      color: #333;
    }
    #btnPdf { margin-top: 20px; padding: 10px 20px; background-color: #007BFF; color: #fff; border: none; cursor: pointer; }
    #btnPdf:hover { background-color: #0056b3; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ðŸ“‹ Ãšltimo Registro de Atendimento</h2>
    <div class="info"><span class="label">GÃªnero:</span> <span id="genero"></span></div>
    <div class="info"><span class="label">Perfil EtÃ¡rio:</span> <span id="perfil"></span></div>
    <div class="info"><span class="label">Hora InÃ­cio:</span> <span id="horaInicio"></span></div>
    <div class="info"><span class="label">Hora Mal SÃºbito:</span> <span id="horaMalSubito"></span></div>
    <div class="info"><span class="label">Ciclos Realizados:</span> <span id="ciclos"></span></div>
    <div class="info"><span class="label">EndereÃ§o:</span> <span id="endereco"></span></div>
    <div class="info"><span class="label">Acionamento da EmergÃªncia:</span> <span id="horaEmergencia"></span></div>
    <div class="info"><span class="label">Encerramento Atendimento:</span> <span id="dataRegistro"></span></div>
    <hr>
    <button id="btnPdf">Salvar PDF</button>
  </div>

  <script src="js/jspdf.umd.min.js"></script>
  <script>
  // Recupera o Ãºltimo atendimento do localStorage
  const atendimentos = JSON.parse(localStorage.getItem("atendimentos")) || [];
  const atendimento = atendimentos[atendimentos.length - 1];

  if (atendimento) {
    document.getElementById("genero").textContent = atendimento.genero;
    document.getElementById("perfil").textContent = atendimento.perfil;
    document.getElementById("horaInicio").textContent = atendimento.horaInicio;
    document.getElementById("horaMalSubito").textContent = atendimento.horaMalSubito;
    document.getElementById("ciclos").textContent = atendimento.ciclos;
    document.getElementById("endereco").textContent = atendimento.endereco;
    document.getElementById("horaEmergencia").textContent = atendimento.horaEmergencia;
    document.getElementById("dataRegistro").textContent = atendimento.dataRegistro;

    // BotÃ£o salvar PDF
    document.getElementById("btnPdf").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(16);
      doc.text("Ãšltimo Atendimento Registrado", 105, 20, { align: "center" });

      doc.setFontSize(12);
      let y = 40;
      const campos = [
        { label: "GÃªnero", valor: atendimento.genero },
        { label: "Perfil EtÃ¡rio", valor: atendimento.perfil },
        { label: "Hora de InÃ­cio", valor: atendimento.horaInicio },
        { label: "Hora Mal SÃºbito", valor: atendimento.horaMalSubito },
        { label: "Ciclos Realizados", valor: atendimento.ciclos },
        { label: "EndereÃ§o", valor: atendimento.endereco },
        { label: "Hora da EmergÃªncia", valor: atendimento.horaEmergencia },
        { label: "Data de Registro", valor: atendimento.dataRegistro },
      ];

      campos.forEach(c => {
        doc.text(`${c.label}: ${c.valor}`, 20, y);
        y += 10;
      });
  
      // Gerar nome do arquivo baseado na dataRegistro
    const nomeArquivo = `atendimento_${atendimento.dataRegistro.replace(/[:\/]/g, "_")}.pdf`;
    doc.save(nomeArquivo);

});

  } else {
    document.body.innerHTML = "<h2>Nenhum atendimento registrado ainda.</h2>";
  }
</script>

</body>
</html>
